/* Haven - Animations, Effects, Transitions */

/* ─── MERGE FLASH + SHRINK ────────────────────────────────── */

.cell.merging .item {
    animation: merge-flash 0.35s ease-out forwards;
}

@keyframes merge-flash {
    0%   { filter: brightness(1); transform: scale(1); opacity: 1; }
    25%  { filter: brightness(2.5); transform: scale(1.15); }
    60%  { filter: brightness(1.5); transform: scale(0.6); opacity: 0.8; }
    100% { filter: brightness(0.5); transform: scale(0); opacity: 0; }
}

/* ─── NEW MERGED ITEM POP ─────────────────────────────────── */

.item.merge-result {
    animation: merge-pop 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes merge-pop {
    0%   { transform: scale(0) rotate(-8deg); }
    55%  { transform: scale(1.2) rotate(2deg); }
    75%  { transform: scale(0.95); }
    100% { transform: scale(1) rotate(0); }
}

/* ─── SPAWN POP ───────────────────────────────────────────── */

.item.spawn-in {
    animation: spawn-pop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes spawn-pop {
    0%   { transform: scale(0) rotate(-12deg); opacity: 0; }
    50%  { transform: scale(1.15) rotate(3deg); opacity: 1; }
    100% { transform: scale(1) rotate(0); }
}

/* ─── SCREEN SHAKE ────────────────────────────────────────── */

.screen-shake {
    animation: board-shake 0.35s ease-out;
}

@keyframes board-shake {
    0%, 100% { transform: translate(0, 0); }
    10%  { transform: translate(-3px, 2px); }
    20%  { transform: translate(4px, -1px); }
    30%  { transform: translate(-4px, -2px); }
    40%  { transform: translate(3px, 2px); }
    50%  { transform: translate(-2px, 1px); }
    60%  { transform: translate(2px, -1px); }
    70%  { transform: translate(-1px, 1px); }
    80%  { transform: translate(1px, 0); }
}

/* ─── ENERGY SHAKE (when empty) ───────────────────────────── */

.shake {
    animation: energy-shake 0.45s ease-out;
}

@keyframes energy-shake {
    0%, 100% { transform: translateX(0); }
    15%  { transform: translateX(-4px); }
    30%  { transform: translateX(4px); }
    45%  { transform: translateX(-3px); }
    60%  { transform: translateX(3px); }
    75%  { transform: translateX(-1px); }
    90%  { transform: translateX(1px); }
}

/* ─── DRAGGING ITEM ───────────────────────────────────────── */

.item.dragging {
    transform: scale(1.12) !important;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
    opacity: 0.92;
    border-color: rgba(255, 215, 0, 0.4) !important;
}

/* ─── HIGH TIER GLOW PULSE ────────────────────────────────── */

.item.tier-4 {
    animation: glow-soft 2.5s ease-in-out infinite;
}

.item.tier-5,
.item.tier-6 {
    animation: glow-strong 2s ease-in-out infinite;
}

@keyframes glow-soft {
    0%, 100% { filter: brightness(1); }
    50%      { filter: brightness(1.1); }
}

@keyframes glow-strong {
    0%, 100% { filter: brightness(1); }
    50%      { filter: brightness(1.2); }
}

/* ─── RESOURCE NODE PULSE ─────────────────────────────────── */

.node {
    animation: node-breathe 3s ease-in-out infinite;
}

@keyframes node-breathe {
    0%, 100% { border-color: var(--bg-light); }
    50%      { border-color: rgba(255, 215, 0, 0.2); }
}

/* ─── VALID TARGET GLOW ───────────────────────────────────── */

.cell.valid-target {
    animation: target-pulse 0.7s ease-in-out infinite alternate;
}

@keyframes target-pulse {
    0%   { background: rgba(255, 215, 0, 0.1); box-shadow: inset 0 0 6px rgba(255, 215, 0, 0.15); }
    100% { background: rgba(255, 215, 0, 0.22); box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.3); }
}

/* ─── FLOATING TEXT ───────────────────────────────────────── */

@keyframes float-up {
    0%   { opacity: 1; transform: translateX(-50%) translateY(0); }
    70%  { opacity: 1; }
    100% { opacity: 0; transform: translateX(-50%) translateY(-60px); }
}

/* ─── IDLE ITEM BOB (subtle) ──────────────────────────────── */

.cell:not(.merging) .item:not(.drag-source):not(.spawn-in):not(.merge-result) {
    animation: idle-bob 4s ease-in-out infinite;
    animation-delay: var(--bob-delay, 0s);
}

@keyframes idle-bob {
    0%, 100% { transform: translateY(0); }
    50%      { transform: translateY(-1px); }
}
